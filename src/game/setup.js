import {version} from '../../package.json';

export default function Setup(g) {
  g.imgs['bg'] = mkBg(g, g.imgs['bg'], 8, 0.2);
  g.imgs['bg2'] = mkBg(g, g.imgs['bg2'], 3, 0.17);
  g.imgs['pointer'] = g.draw.resize(g.imgs['pointer'], 4);
  g.imgs['hole'] = mkHole(g, g.imgs['hole']);
  g.imgs['wormtail'] = mkTail(g, 4);
  g.imgs['wormtail_flipX'] = g.draw.flip(g.imgs['wormtail'], 1);
  g.imgs['wormtail_flipY'] = g.draw.flip(g.imgs['wormtail'], 0, 1);
  g.imgs['titleFont'] = g.H.mkFont(g, 8, 2);
  g.imgs['_titleFont'] = g.H.mkFont(g, 8, 0);

  g.imgs['heart'] = g.draw.resize(g.imgs['heart'], 4);

  g.imgs['bg_skull'] = g.draw.rotate(g.draw.resize(g.imgs['skull'], 6, 0.1), 4.4);
  g.imgs['bg_skull_flip'] = g.draw.flip(g.imgs['bg_skull'], 1, 0);
  g.imgs['bg_bone'] = g.draw.rotate(g.draw.resize(g.imgs['bone'], 2, 0.1), 4.4);
  g.imgs['bg_bone_flip'] = g.draw.flip(g.imgs['bg_bone'], 1, 0);

  g.imgs['bg_grass'] = g.draw.resize(g.imgs['grass'], 4, 0.2);
  g.imgs['13'] = g.draw.resize(g.imgs['13'], 3, 0.5);


g.p8S =
`000e00001776217760177601776017762177601776017760177621776017762177601e7621e7601f7621f7601f7601f7601f7621f7601c7621c7601e7621e7601a7621a7601c7621c76019762197601a7621a760
000e00000b2200b22017220172200b2200b22017220172200b2200b22017220172200b2200b22017220172200b2200b22017220172200b2200b22017220172200b2200b22017220172200b2200b2201722017220
000e00001a7621a7601a7601a7601a7621a7601a7601a7601a7621a7601a7621a76021762217602276222760227602276022762227601f7621f76021762217601d7621d7601f7621f7601c7621c7601d7621d760
000e00000e2200e2201a2201a2200e2200e2201a2201a2200e2200e2201a2201a2200e2200e2201a2201a2200e2200e2201a2201a2200e2200e2201a2201a2200e2200e2201a2201a2200e2200e2201a2201a220
010e00000c053000003f215000000c053000003f215000000c053000003f215000000c053000003f215000000c053000003f215000000c053000003f215000000c053000003f215000000c053000003f21500000`;
g.p8M =
`00 00010404
00 00010404
00 02030404
04 02030404`;


g.p8S2 =
`000e000021740217101c7401c710217402171023740237102474024710237402371021740217101f7401f7101d7401d71018740187101d7401d7101f7401f71021740217101f7401f7101d7401d7102174021710
000e00001f7401f7101a7401a7101f7401f7102174021710237402371021740217101f7401f71023740237101c7401c71017740177101c7401c7101e7401e7101f7401f7101e7401e7101c7301c7101e7301e710
000e00001511015110151101511015110151101511015110151101511015110151101511015110151101511011110111101111011110111101111011110111101111011110111101111011110111101111011110
001000002153121520215202152021520215202152021520215200000023520000002452000000215202152021520215202152021520215202152021520000000000000000000000000000000000000000000000
000e00001311013110131101311013110131101311013110131101311013110131101311013110131101311010110101101011010110101101011010110101101011010110101101011010110101101011010110
000e00002353123520235202352023520235202352023520235200000000000000000000000000245200000023520235202352023520235202352023520235202352000000000000000000000000000000000000
000e00002153121520215202152021520215202152021520215200000000000000002352000000245200000021520215202152021520215202152021520215202152000000000000000023520000002452000000
000e19002652026520265202652026520265202652026520265200000000000000002852000000295200000028520285202852028520285202852028520285202852001400014000140001400014000140001400`;
g.p8M2 =
`00 00404140
00 01414240
00 00400240
00 01410440
00 00030243
00 01050440
00 00060240
04 01070440`;

g.p8S3 =
`000e0000070600000000000070601106000000130600000007060000000706000000090600a06009060050600706000000000000706011060000001306000000070600000007060000000c0600e0600c0600a060
010e00001a76200000000001a76200000000001a7621f76221762000000000021762000000000021762227621a76200000000001a76200000000001a7621f7621d76200000000001d76200000000001d7621b762
010e00000c043000003f2150000024615000003f215000000c043000003f2150000024615282003f215000000c043000003f2150000024615000003f215000000c043000003f2150000024615000003f21532200
000e00001a76200000000001a76200000000001a7621f762217620000000000217620000000000217622276224762000000000024762000000000024762227622176200000000002176200000000001d7621b762`;
g.p8M3 =
`00 00010240
04 00030240`;

  document.querySelector('#c').style.cursor = 'none';
  g.voice = loadSound('t');
  g.letsgo = loadSound('letsgo');

  console.log(`%c ${g.data.title} V:${version} (${window.BUILD || 'DEV'})`, 'background: #222; color: #bada55');
}

function mkTail(g, len = 4) {

  let i = g.imgs['circle'],
      i2 = g.draw.color(i, g.data.pal[1]),
      c = g.H.mkCanvas(i.width * len, i.height + 4),
      ctx = c.getContext('2d');

  let x = 0, w = i.width;

  for (let n = 0; n <= len; n += 1) {
    let y = n % 2 ? 4 : 0;
    ctx.drawImage(n % 2 ? i : i2, (x + (w / 2) * n), y);
  }

  return c;
}

function mkHole(g, i) {
  let c = g.H.mkCanvas(i.width * 2, i.height),
  ctx = c.getContext('2d');
  ctx.drawImage(i, 0, 0);
  ctx.drawImage(i, i.width, 0);
  return c;
}

function mkBg(g, i, scale = 1, o = 1) {
  i = g.draw.resize(i, scale, o);
  let rows = Math.ceil(g.w / i.width),
      cols = Math.ceil(g.h / i.height);
      c = g.H.mkCanvas(g.w, g.h),
      ctx = c.getContext('2d')  ;

  for (let y = 0; y <= cols; y += 1) {
    for (let x = 0; x <= rows; x += 1) {
      ctx.drawImage(i, x * i.width, y * i.width);
    }
  }

  return c;
}

function loadSound(n) {
    let sound = document.createElement("audio");
    if ("src" in sound) {
        sound.autoPlay = false;
    }
    else {
        sound = document.createElement("bgsound");
        sound.volume = -10000;
    }
    sound.src = window.BUILD ? `public/${n}.mp3` : `${n}.mp3`;
    sound.id = n;
    document.body.appendChild(sound);
    return sound;
}
